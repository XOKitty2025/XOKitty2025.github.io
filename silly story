public class bookTester {
    static ArrayList<Book> books = new ArrayList<Book>();
    static Scanner input = new Scanner(System.in);

    public static void main(String[] args) {
        loadBooksFromFile();

        int choice = 0;
        while (choice != 3) {
            System.out.println("Library Menu");
            System.out.println("1. View all books");
            System.out.println("2. Add a new book");
            System.out.println("3. Exit");
            System.out.print("Enter your choice: ");
            
            try {
                choice = input.nextInt();
                input.nextLine(); 

                if (choice == 1) {
                    printBooks();
                } else if (choice == 2) {
                    addBook();
                } else if (choice == 3) {
                    saveBooksToFile();
                    System.out.println("Goodbye!");
                } else {
                    System.out.println("Invalid choice.");
                }
            } catch (Exception e) {
                System.out.println("Please enter a number.");
                input.nextLine(); 
                
            }
        }
    }

    public static void loadBooksFromFile() {
        try {
            File file = new File("books.txt");
            Scanner fileInput = new Scanner(file);

            while (fileInput.hasNextLine()) {
                String line = fileInput.nextLine();
                String[] parts = line.split(",");
                if (parts.length == 3) {
                    String title = parts[0];
                    String author = parts[1];
                    int year = Integer.parseInt(parts[2]);
                    books.add(new Book(title, author, year));
                }
            }

            fileInput.close();
        } catch (FileNotFoundException e) {
            System.out.println("books.txt not found. Starting with an empty library.");
        }
    }

    public static void saveBooksToFile() {
        try {
            PrintWriter writer = new PrintWriter("books.txt");
            for (Book b : books) {
                writer.println(b.toFileString());
            }
            writer.close();
        } catch (FileNotFoundException e) {
            System.out.println("Could not write to file.");
        }
    }

    public static void printBooks() {
        if (books.size() == 0) {
            System.out.println("No books in the library.");
        } else {
            for (Book b : books) {
                System.out.println(b);
            }
        }
    }

    public static void addBook() {
        System.out.print("Enter book title: ");
        String title = input.nextLine();

        System.out.print("Enter author: ");
        String author = input.nextLine();

        System.out.print("Enter year: ");
        int year = input.nextInt();
        input.nextLine(); 

        Book newBook = new Book(title, author, year);
        books.add(newBook);

        System.out.println("Book added!");
    }
}
